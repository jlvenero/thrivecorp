name: Deploy Backend to Elastic Beanstalk

on:
  push:
    branches: [ main ] # Roda na sua branch 'main'
    paths:
      - 'backend/**' # S√≥ roda se mudar a pasta 'backend'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout source code
        uses: actions/checkout@v4 # Baixa o seu c√≥digo

      # Esta etapa cria o .zip APENAS com o conte√∫do do backend
      - name: Generate deployment package
        run: |
          cd backend # Entra na pasta do backend
          zip -r ../deploy-backend.zip . -x '*.git*'
          cd .. # Volta para a raiz

      - name: Deploy to EB
        uses: einaregilsson/beanstalk-deploy@v22 # üëà A ACTION CORRETA QUE VOC√ä ACHOU
        with:
          # Segredos da AWS
          aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          
          # Nomes do seu ambiente
          application_name: thrivecorp # ‚úèÔ∏è MUDE (se for diferente)
          environment_name: Thrivecorp-env # ‚úèÔ∏è MUDE (se for diferente)
          region: us-east-2 # ‚úèÔ∏è MUDE (Ohio √© us-east-2)

          # O pacote de deploy
          version_label: "v-${{ github.sha }}" # Um nome de vers√£o √∫nico
          deployment_package: deploy-backend.zip # O zip que criamos acima