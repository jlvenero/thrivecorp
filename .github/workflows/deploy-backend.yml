name: Deploy Backend to Elastic Beanstalk

on:
  push:
    branches: [ main ] # Roda na sua branch 'main'
    paths:
      - 'backend/**' # SÃ³ roda se mudar a pasta 'backend'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:

      - name: Checkout source code
        uses: actions/checkout@v4 # Baixa o seu cÃ³digo

      # Esta etapa cria o .zip APENAS com o conteÃºdo do backend
      - name: Generate deployment package
        run: |
          cd backend # Entra na pasta do backend
          npm install --production # ğŸ‘ˆ ADICIONE ESTA LINHA
          zip -r ../deploy-backend.zip . -x '*.git*' # ğŸ‘ˆ LINHA MODIFICADA
          cd ..

      - name: Deploy to EB
        uses: einaregilsson/beanstalk-deploy@v22 # ğŸ‘ˆ A ACTION CORRETA QUE VOCÃŠ ACHOU
        with:
          # Segredos da AWS
          aws_access_key: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws_secret_key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          
          # Nomes do seu ambiente
          application_name: thriveCorp2 # âœï¸ MUDE (se for diferente)
          environment_name: ThriveCorp2-env # âœï¸ MUDE (se for diferente)
          region: us-east-2 # âœï¸ MUDE (Ohio Ã© us-east-2)

          # O pacote de deploy
          version_label: "v-${{ github.sha }}" # Um nome de versÃ£o Ãºnico
          deployment_package: deploy-backend.zip # O zip que criamos acima